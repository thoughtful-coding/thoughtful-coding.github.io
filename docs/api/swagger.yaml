openapi: 3.0.0
info:
  title: Thoughtful Python Learning Platform API
  version: v1.3.0
  description: |
    REST API for the Thoughtful Python interactive learning platform supporting student progress tracking,
    AI-powered learning assessments, and instructor oversight.

    **Authentication:** Google OAuth 2.0 with JWT tokens (access token: 1 hour, refresh token: 30 days)

    **v1.3.0 Changes:** Standardized error responses - all errors now include required `errorCode` field for programmatic handling

    **Data Hierarchy:** Unit → Lesson (GUID) → Section

    **Rate Limits:** AI endpoints: 10/min, Other: 100/min per user

    **Pagination:** DynamoDB LastEvaluatedKey pattern (pass opaque object to next request)

servers:
  - url: https://3kyvgl1ck0.execute-api.us-east-2.amazonaws.com
    description: API Gateway endpoint

tags:
  - name: Authentication
    description: Google OAuth 2.0 authentication endpoints.
  - name: User Progress
    description: Operations related to student learning progress.
  - name: Student Submissions
    description: Operations for students submitting Reflections and PRIMM activities.
  - name: Instructor Portal
    description: Operations for instructors to view student data and class progress.

components:
  schemas:
    # Core Data Types
    UnitId:
      $ref: "./schemas/common.yaml#/UnitId"
    LessonId:
      $ref: "./schemas/common.yaml#/LessonId"
    SectionId:
      $ref: "./schemas/common.yaml#/SectionId"
    PrimmExampleId:
      $ref: "./schemas/common.yaml#/PrimmExampleId"
    IsoTimestamp:
      $ref: "./schemas/common.yaml#/IsoTimestamp"
    AssessmentLevel:
      $ref: "./schemas/common.yaml#/AssessmentLevel"
    LastEvaluatedKey:
      $ref: "./schemas/common.yaml#/LastEvaluatedKey"
    CompletionMap:
      $ref: "./schemas/common.yaml#/CompletionMap"
    LessonCompletionMap:
      $ref: "./schemas/common.yaml#/LessonCompletionMap"
    UnitCompletionMap:
      $ref: "./schemas/common.yaml#/UnitCompletionMap"
    BasicUserInfo:
      $ref: "./schemas/common.yaml#/BasicUserInfo"
    PrimmIdentifiers:
      $ref: "./schemas/common.yaml#/PrimmIdentifiers"

    # Authentication Schemas
    GoogleLoginRequest:
      $ref: "./schemas/authentication.yaml#/GoogleLoginRequest"
    TokenRefreshRequest:
      $ref: "./schemas/authentication.yaml#/TokenRefreshRequest"
    LogoutRequest:
      $ref: "./schemas/authentication.yaml#/LogoutRequest"
    AuthTokenResponse:
      $ref: "./schemas/authentication.yaml#/AuthTokenResponse"

    # Progress Schemas
    SectionCompletionInput:
      $ref: "./schemas/progress.yaml#/SectionCompletionInput"
    BatchCompletionsInput:
      $ref: "./schemas/progress.yaml#/BatchCompletionsInput"
    UserProgressResponse:
      $ref: "./schemas/progress.yaml#/UserProgressResponse"

    # Reflection Schemas
    ReflectionInteractionInput:
      $ref: "./schemas/reflections.yaml#/ReflectionInteractionInput"
    ReflectionVersionItem:
      $ref: "./schemas/reflections.yaml#/ReflectionVersionItem"
    ListOfReflectionDraftsResponse:
      $ref: "./schemas/reflections.yaml#/ListOfReflectionDraftsResponse"

    # PRIMM Schemas
    PrimmEvaluationRequest:
      $ref: "./schemas/primm.yaml#/PrimmEvaluationRequest"
    PrimmEvaluationResponse:
      $ref: "./schemas/primm.yaml#/PrimmEvaluationResponse"

    # Instructor Schemas
    InstructorStudentInfo:
      $ref: "./schemas/instructor.yaml#/InstructorStudentInfo"
    ListOfInstructorStudentsResponse:
      $ref: "./schemas/instructor.yaml#/ListOfInstructorStudentsResponse"
    StudentUnitCompletionDataItem:
      $ref: "./schemas/instructor.yaml#/StudentUnitCompletionDataItem"
    ClassUnitProgressResponse:
      $ref: "./schemas/instructor.yaml#/ClassUnitProgressResponse"
    StudentLearningEntriesResponse:
      $ref: "./schemas/instructor.yaml#/StudentLearningEntriesResponse"
    StoredPrimmSubmissionItem:
      $ref: "./schemas/instructor.yaml#/StoredPrimmSubmissionItem"
    StudentPrimmSubmissionsResponse:
      $ref: "./schemas/instructor.yaml#/StudentPrimmSubmissionsResponse"
    AssignmentSubmission:
      $ref: "./schemas/instructor.yaml#/AssignmentSubmission"
    ListOfAssignmentSubmissionsResponse:
      $ref: "./schemas/instructor.yaml#/ListOfAssignmentSubmissionsResponse"
    SectionStatusItem:
      $ref: "./schemas/instructor.yaml#/SectionStatusItem"
    LessonProgressProfile:
      $ref: "./schemas/instructor.yaml#/LessonProgressProfile"
    UnitProgressProfile:
      $ref: "./schemas/instructor.yaml#/UnitProgressProfile"
    StudentDetailedProgressResponse:
      $ref: "./schemas/instructor.yaml#/StudentDetailedProgressResponse"

    # Error Schema
    ErrorResponse:
      $ref: "./schemas/errors.yaml#/ErrorResponse"

  parameters:
    PaginationLimit:
      $ref: "./parameters/common.yaml#/PaginationLimit"
    PaginationKey:
      $ref: "./parameters/common.yaml#/PaginationKey"
    LearningEntriesFilter:
      $ref: "./parameters/common.yaml#/LearningEntriesFilter"
    StudentIdParam:
      $ref: "./parameters/common.yaml#/StudentIdParam"
    LessonIdParam:
      $ref: "./parameters/common.yaml#/LessonIdParam"
    SectionIdParam:
      $ref: "./parameters/common.yaml#/SectionIdParam"
    UnitIdParam:
      $ref: "./parameters/common.yaml#/UnitIdParam"
    LessonIdQueryParam:
      $ref: "./parameters/common.yaml#/LessonIdQueryParam"
    SectionIdQueryParam:
      $ref: "./parameters/common.yaml#/SectionIdQueryParam"

  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: "JWT token obtained from the `/auth/login` endpoint. Include in the Authorization header as: `Bearer <token>`"

  responses:
    BadRequest:
      $ref: "./responses/common.yaml#/BadRequest"
    Unauthorized:
      $ref: "./responses/common.yaml#/Unauthorized"
    Forbidden:
      $ref: "./responses/common.yaml#/Forbidden"
    NotFound:
      $ref: "./responses/common.yaml#/NotFound"
    InternalServerError:
      $ref: "./responses/common.yaml#/InternalServerError"
    TooManyRequests:
      $ref: "./responses/common.yaml#/TooManyRequests"

security:
  - BearerAuth: []

paths:
  # Authentication
  /auth/login:
    $ref: "./paths/authentication.yaml#/~1auth~1login"
  /auth/refresh:
    $ref: "./paths/authentication.yaml#/~1auth~1refresh"
  /auth/logout:
    $ref: "./paths/authentication.yaml#/~1auth~1logout"

  # User Progress
  /progress:
    $ref: "./paths/progress.yaml#/~1progress"

  # Student Submissions - Reflections
  /reflections/{lessonId}/sections/{sectionId}:
    $ref: "./paths/reflections.yaml#/~1reflections~1{lessonId}~1sections~1{sectionId}"

  # Student Submissions - Learning Entries
  /learning-entries:
    $ref: "./paths/student-learning.yaml#/~1learning-entries"

  # Student Submissions - PRIMM
  /primm-feedback:
    $ref: "./paths/primm.yaml#/~1primm-feedback"

  # Instructor Portal
  /instructor/students:
    $ref: "./paths/instructor/students.yaml#/~1instructor~1students"
  /instructor/units/{unitId}/class-progress:
    $ref: "./paths/instructor/progress.yaml#/~1instructor~1units~1{unitId}~1class-progress"
  /instructor/students/{studentId}/learning-entries:
    $ref: "./paths/instructor/learning-entries.yaml#/~1instructor~1students~1{studentId}~1learning-entries"
  /instructor/students/{studentId}/primm-submissions:
    $ref: "./paths/instructor/learning-entries.yaml#/~1instructor~1students~1{studentId}~1primm-submissions"
  /instructor/units/{unitId}/lessons/{lessonId}/sections/{sectionId}/assignment-submissions:
    $ref: "./paths/instructor/assignments.yaml#/~1instructor~1units~1{unitId}~1lessons~1{lessonId}~1sections~1{sectionId}~1assignment-submissions"
  /instructor/students/{studentId}/detailed-progress:
    $ref: "./paths/instructor/detailed-progress.yaml#/~1instructor~1students~1{studentId}~1detailed-progress"
